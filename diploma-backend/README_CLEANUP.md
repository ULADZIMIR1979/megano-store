# Инструмент очистки устаревших файлов

## Описание
Этот инструмент позволяет очищать устаревшие файлы из папки media, которые больше не связаны с объектами в базе данных.

## Установка и настройка

### 1. Установка django-cleanup
В проекте уже установлен пакет `django-cleanup`, который автоматически удаляет файлы при удалении объектов из базы данных:

```
pip install django-cleanup
```

### 2. Настройка в settings.py
Убедитесь, что `django_cleanup.apps.CleanupConfig` добавлен в конец списка `INSTALLED_APPS` в файле `backend/settings.py`:

```python
INSTALLED_APPS = [
    ...
    'django_cleanup.apps.CleanupConfig',
]
```

## Использование

### Проверка устаревших файлов (тестовый запуск)
```
python cleanup_media.py --dry-run
```

### Фактическое удаление устаревших файлов
```
python cleanup_media.py
```

## Функциональность

Скрипт `cleanup_media.py`:

1. Сканирует папку media и все её подпапки
2. Сравнивает файлы с записями в базе данных для следующих моделей:
   - `Category.image` - изображения категорий
   - `ProductImage.src` - изображения товаров
   - `User.avatar` - аватары пользователей
3. Находит файлы, которые не связаны ни с одним объектом в базе данных
4. Удаляет эти файлы (в случае запуска без флага `--dry-run`)

## Важно
- Всегда используйте флаг `--dry-run` перед фактическим удалением, чтобы убедиться, что удаляются только действительно устаревшие файлы
- Рекомендуется создать резервную копию папки media перед выполнением очистки
- Пакет `django-cleanup` автоматически удаляет файлы при удалении объектов из базы данных, но этот скрипт помогает очистить уже существующие устаревшие файлы